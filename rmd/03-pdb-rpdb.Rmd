# Chapter 3: PADRINO and Rpadrino: a toolkit for rebuilding and analyzing published Integral Projection Models

Sam C. Levin $^{\ast1,2,3}$, Sanne Evers $^{1,2}$, Tomos Potter$^{3}$, Mayra Pe$\mathrm{\tilde{n}}$a Guerrero $^{1,2}$, Dylan Z. Childs $^4$, Aldo Compagnoni $^{1,2,3}$, Tiffany M. Knight $^{1,2,5\ddagger}$, Roberto Salguero-Gómez $^{3\ddagger}$

$^1$Institute of Biology, Martin Luther University Halle-Wittenberg, Am Kirchtor 1, 06108 Halle (Saale), Germany

$^2$German Centre for Integrative Biodiversity Research (iDiv) Halle-Jena-Leipzig, Deutscher Platz 5e, 04103 Leipzig, Germany

$^3$Department of Zoology, 11a Mansfield Rd, University of Oxford, Oxford, OX1 3SZ, UK

$^4$Department of Animal and Plant Sciences, University of Sheffield, Sheffield, S10 2TN, UK

$^5$Department of Community Ecology, Helmholtz Centre for Environmental Research-UFZ, Theodor-Lieser-Straße 4, 06120, Halle (Saale), Germany

$^\ddagger$ Joint senior authors


```{r echo = FALSE, message = FALSE, warning = FALSE}
library(dplyr)
library(purrr)
library(grid)
library(patchwork)
library(ggplot2)
library(Rpadrino)
library(knitr)
library(sf)
library(png)
library(kableExtra)


ipm_pubs <- read.csv('Data/all_ipm_papers_20210806.csv',
                     stringsAsFactors = FALSE) %>% 
  filter(!is.na(Kingdom) & Kingdom != "")

names(ipm_pubs) <- gsub("\\.\\.", "_", names(ipm_pubs))
names(ipm_pubs) <- gsub("\\.$", "", names(ipm_pubs))
names(ipm_pubs) <- gsub("\\.", "_", names(ipm_pubs))

ipm_id <- pmap_chr(.l = data.frame(a = ipm_pubs$Authors,
                                   b = ipm_pubs$Journal, 
                                   c = ipm_pubs$Year),
               .f = function(a, b, c) paste(a, b, c, sep = "_")) 

ipm_pubs <- cbind(ipm_pubs, ipm_id)
ipm_pubs$Year <- as.integer(ipm_pubs$Year)

pub_tot  <- length(unique(ipm_id))

kingdoms <- ipm_pubs %>% 
  group_by(Kingdom) %>%
  summarise(N     = length(unique(Full_citation_APA)),
            n_spp = length(unique(Species))) 


pdb <- pdb_download(save = FALSE)


tab <- pdb$Metadata %>% 
  group_by(kingdom) %>%
  summarise(
    IPMs = length(unique(ipm_id)),
    spp  = length(unique(species_accepted)),
    pap  = length(unique(apa_citation))
  )

tot <- pdb$Metadata %>% 
  summarise(
    kingdom = "Totals",
    IPMs = length(unique(ipm_id)),
    spp  = length(unique(species_accepted)),
    pap  = length(unique(apa_citation))
  ) %>%
  rbind(tab)

n_animalia <- tot[tot$kingdom == "Animalia", "pap"]
n_plantae  <- tot[tot$kingdom == "Plantae", "pap"]
n_tot      <- tot[tot$kingdom == "Totals", "IPMs"]
n_pap      <- tot[tot$kingdom == "Totals", "pap"]

```

# Abstract

1. Discrete time structured population projection models are an important tool for studying population dynamics. Within this field, Integral Projection Models (IPMs) have become a popular method for studying populations structured by continuously distributed traits (_e.g._ height, weight). Databases of discrete time, discrete state structured population models, for example DATLife (life tables) and COMPADRE & COMADRE (matrix population models), have made quantitative syntheses straightforward to implement. These efforts allow researchers to address questions in both basic and applied ecology and evolutionary biology. There are now over `r round(sum(pub_tot), -1)` peer-reviewed publications containing IPMs. I describe a novel method to quickly reconstruct these models for subsequent analyses with PADRINO, a new demographic database. 

2. I introduce the open access database of IPMs, PADRINO, and its accompanying R package, _Rpadrino_, which enables users to download, subset, reconstruct, and extend published IPMs. _Rpadrino_ makes use of recently created software, _ipmr_, to provide an engine to reconstruct a wide array of IPMs from their symbolic representations and conduct subsequent analyses.

3. In the first release (v0.0.1), PADRINO houses `r n_tot` IPMs from `r n_pap` publications that describe the demography of `r n_animalia` animal and `r n_plantae` plant species. All IPMs in PADRINO are tested to ensure they reproduce published estimates. Furthermore, PADRINO is designed to allow users to add data from external sources and modify parameter values, providing a platform for extending models beyond their original purpose while allowing for full reproducibility.

4. PADRINO and _Rpadrino_ provide a toolbox for asking new questions and conducting syntheses with peer-reviewed published IPMs. _Rpadrino_ provides a user-friendly interface so researchers do not need to worry about the database structure or syntax, and can focus on their research questions and analyses. Additionally, _Rpadrino_ is thoroughly documented, and provides numerous examples of how to perform analyses which are not included in the package's functionality. 

**Keywords**: Elasticity, database, demography, open access, population dynamics, life history, sensitivity

## Introduction

Demography provides an excellent approach to examine the ecology (Crone et al. 2011), evolutionary biology (Metcalf & Pavard 2007), and conservation biology of any species (Doak & Morris 2001). Environmental conditions and biotic interactions influence vital rates (_e.g._ survival, development, reproduction) across the entire life cycle, which then govern its short-term and long-term performance (Caswell 2001). A variety of methods exist for summarizing vital rates into demographic models; discrete-time, structured population models are among the most popular (Crone et al. 2011, Caswell 2001). Indeed, there is a rich history of using such structured population models across a variety of sub-disciplines in ecology (_e.g._ Leslie 1945, Caswell 2001, Easterling et al. 2000, Adler et al. 2010, Ellner et al. 2016).

Matrix projection models (MPMs) are the most widely used structured population model. MPMs divide the population into discrete classes corresponding to some trait value (_e.g._ developmental state, age, or size), and then model the population using vital rates computed for each class. The popularity of MPMs and the desire to conduct quantitative syntheses led to the creation of databases that enable researchers to reproduce and analyze published MPMs en masse (Salguero-Gómez et al. 2014, Salguero-Gómez et al. 2015).

Recent advances in the availability of this structured demographic information have powered large scale syntheses to answer a variety of questions in both theoretical and applied ecology. For example, Jelbert and colleagues (2019) used the COMPADRE database (Salguero-Gómez et al. 2014) to show that the intrinsic ability of plant populations to benefit from disturbance in the short term (amplification *sensu* Stott et al. 2011) predicts invasiveness in novel environments. Similarly, Healy and colleagues (2019) used the COMADRE database animal MPMs (Salguero-Gómez et al. 2015) to demonstrate how patterns of animal life history strategies are shaped by trade-offs between distributions of age-specific mortality and reproduction. Using DATLife (DATLife Database 2021), an open access repository of life tables, Hartemink & Caswell (2018) decomposed the variance in individual longevity into contributions from individual heterogeneity and individual stochasticity in 10 invertebrate species. 

For many species, vital rates are best predicted as a function of one or more continuous trait (e.g. size, height, mass), rather than as a function of discrete classes.  Integral projection models (IPMs), which are continuously structured population models, have become an increasingly important tool for ecologists interested in addressing broad biological questions through a demographic lens (Gonzalez et al. 2021). IPMs combine vital rate functions of continuous traits into projection kernels, which describe how the abundance and distribution of trait values in a population change in discrete time (Easterling et al. 2000). IPMs have been used to investigate a variety of topics, such as invasive species spread (_e.g._ Jongejans et al. 2011, Erickson et al. 2017), evolutionary stable strategies (_e.g._ Childs et al. 2004), the effect of climate drivers on population persistence (Salguero-Gómez et al. 2012, Compagnoni et al. 2021a), and linking evolutionary feedbacks to population dynamics (Coulson et al. 2011). To date, there are at least `r round(sum(kingdoms$N), -1)` publications covering over `r round(sum(kingdoms$n_spp), -1)` species (Figure 2.1). Given the existing volume of data and its rate of increase, the field of ecology would benefit from a centralized repository that enables researchers to reconstruct and analyze these models to address a multitude of synthetic questions. 

Here, I introduce PADRINO and _Rpadrino_. PADRINO is an open access database of IPMs. Specifically, PADRINO houses symbolic representations of IPMs, their parameter values, and associated metadata to aid users in selecting appropriate models. _Rpadrino_ is an R package that enable users to reconstruct and modify IPMs from PADRINO. In the following, I describe PADRINO's structure and how to efficiently interact with it using _Rpadrino_. Next, I explain how IPMs are digitized into the database, along with metadata and associated assumptions and challenges. I conclude with discussion of future directions for the database. Importantly, our Supplementary Materials contain two case studies. The first case study demonstrates how to use PADRINO and _Rpadrino_ to reconstruct published IPMs, conduct perturbation analyses, compute some life cycle events, and troubleshoot problems. The second case study shows how to use PADRINO, _Rpadrino_, and _ipmr_ to combine PADRINO IPMs with user-specified IPMs, and then how to use PADRINO data with other databases using BIEN (Maitner et al. 2017) and COMPADRE as examples, demonstrating the potential for PADRINO in broad, macro-ecological applications.

\newpage

```{r echo = FALSE, dpi = 450, message = FALSE, warning = FALSE, fig.height = 6, fig.width = 8, fig.cap = "**Figure 2.1**: The geographic and temporal coverage of studies in the PADRINO IPM Database. (A) Geographic distribution of publications currently contained in PADRINO (i.e. studies from Table 2). (B) Cumulative number of publications found by our search criteria by year (solid lines), and the number that are in the released version of PADRINO (dashed lines). Future releases will include those thatI have found, but are not yet completely digitized (i.e. those represented by solid lines, but not yet included in the dashed lines). See the Supplementary Data for a complete list of IPM publications."}

met <- pdb$Metadata

pub_rates <- ipm_pubs %>%
  filter(!duplicated(ipm_id)) %>%
  group_by(Year, Kingdom) %>%
  summarise(n_tot = n()) %>%
  ungroup() %>%
  arrange(Year) %>%
  group_by(Kingdom) %>% 
  mutate(run_sum = cumsum(n_tot)) %>% 
  filter(!is.na(Kingdom) & Kingdom != "") %>%
  mutate(is_pdb = "maybe")

in_pdb <- met %>%
  group_by(pub_year, kingdom) %>%
  summarise(n_tot = length(unique(apa_citation))) %>%
  ungroup() %>%
  arrange(pub_year) %>%
  group_by(kingdom) %>%
  mutate(run_sum = cumsum(n_tot)) %>%
  filter(!is.na(kingdom) & kingdom != "") %>%
  mutate(is_pdb = "yes") %>%
  setNames(c("Year", "Kingdom", "n_tot", "run_sum", "is_pdb")) 

pub_rates <- rbind(pub_rates, in_pdb)


wrld <- st_read("Data/World_Continents/continents.shp", quiet = TRUE) 

wrld_data <- met %>%
  mutate(lat = as.numeric(lat),
         lon = as.numeric(lon)) %>%
  filter(!is.na(lat) | !is.na(lon))


rate_plt <- ggplot(pub_rates,
                   aes(x = Year,
                       y = run_sum,
                       color = Kingdom)) +
  geom_line(aes(linetype = is_pdb),
            size = 1.25) +
  theme_bw() +
  ylab("Cumulative Publications") +
  xlab("Year") + 
  scale_linetype_discrete(guide = FALSE) + 
  scale_color_manual(
    breaks = c("Animalia", "Plantae"),
    values = c("red", "black"),
    labels = c(paste0("Animalia: ", n_animalia),
               paste0("Plantae: ", n_plantae))
  ) +
  theme(legend.direction = "vertical",
        legend.text  = element_text(size = 18),
        legend.title = element_blank(),
        axis.text    = element_text(size = 14),
        axis.title   = element_text(size = 16) ) +
  geom_text(aes(x     = 2000,
                y     = 175, 
                label = "B"), 
            size = 8,
            show.legend =  FALSE)

wrld_plt <- ggplot(wrld,
                   aes(group = CONTINENT)) +
  geom_sf(color = "grey50",
               fill = NA) + 
  coord_sf(xlim = c(-180, 180)) +
  geom_point(data = wrld_data,
             aes(x = lon,
                 y = lat,
                 color = kingdom),
             size = 2.5,
             alpha = 0.6,
             inherit.aes = FALSE) +
  theme_bw() +
  xlab("Longitude") +
  ylab("Latitude") +
  scale_color_manual(
    breaks = c("Animalia", "Plantae"),
    values = c("red", "black"),
    labels = c(paste0("Animalia: ", n_animalia),
               paste0("Plantae: ", n_plantae))
  ) + 
  theme(legend.position = "none",
        plot.background = element_blank(),
        axis.title = element_text(size = 16)) +
  geom_text(aes(x = -179, y = 80, label = "A"), size = 8)

g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  legend
}

leg <- g_legend(rate_plt)

layout <- c(
  area(t = 1, l = 1, b = 3, r = 5),
  area(t = 1, l = 6, b = 2, r = 7),
  area(t = 4, l = 1, b = 5, r = 7)
)

wrld_plt + 
  leg + 
  (rate_plt + theme(legend.position = "none")) + 
  plot_layout(design = layout)



```

## PADRINO

Chapter 1 provides a an introduction to how IPMs are created, and so I will not review that here. Existing approaches to digitizing structured population models entail entering individual transition and reproductive contributions of discrete stages, which are represented by scalar values (_e.g._ COMPADRE and COMADRE). Entering the scalar transition probabilities and reproductive contributions would be difficult for IPMs whose kernels are approximated with relatively small iteration matrices (_e.g._ $45 \times 45$), and impossible for more typical sizes ($100 \times 100$ - $1000 \times 1000$). Furthermore, there is a greater range of subsequent analyses which are possible by capturing the underlying model, rather than its numerical approximation. The recent development of more advanced computational tools, namely _rlang_ (Henry & Wickham 2021) and _ipmr_ (Levin et al. 2021), mean we can now create IPMs from their symbolic representations and the parameters used to implement them. A database containing the functional forms of sub-kernels and vital rate functions, and the parameter values that go into each of those, could accommodate *nearly* all of the existing IPM literature.

PADRINO is an open-access database of integral projection models. PADRINO defines a syntax to symbolically represent IPMs as text strings, and stores the values of those symbols in a separate table. The syntax used is very similar to the mathematical notation of IPMs, and is largely "language-agnostic" (_i.e._ aims to avoid idiosyncrasies of specific programming languages). For example, a survival/growth kernel with the form $P(z',z) = s(z) * G(z',z)$ would be `P = s * G` in PADRINO's syntax. $G(z',z) = f_G(z'|\mu_g(z), \sigma_G)$ (where $f_G$ denotes a normal probability density function) becomes `G = Norm(mu_g, sd_g)`. This notation should be translatable to many computing languages beyond just _R_ (_e.g._ Python or Julia). 

PADRINO v0.0.1 consists of 10 tables (Table 1, Figure S1). In this first version, PADRINO currently contains `r n_tot` IPMs from `r n_pap` peer-reviewed publications that consider `r n_animalia` animal and `r n_plantae` species (Table 2). However, I highlight that PADRINO is under active development, and I continue to digitize studies for release in future versions (see Supplementary Data). These tables form a database, with tables linked using a common column across all tables: `ipm_id`. The scope of each `ipm_id` is determined by the way that an IPM is parameterized. IPMs that characterize the same species across, for example, many years or sites, with the same functional form, are included under a single `ipm_id`. For instance, a growth model that includes a random intercept for different years could be used to generate many unique projection kernels. These are stored under a single `ipm_id` because the functional form of the IPM is identical for each year, and only the parameter values change. One exception to this grouping rule is when the sites (_i.e._ where the raw data are reported to have come from) are far enough apart that separate sets of GPS coordinates are used to describe them. These IPMs are split into separate `ipm_id`s so that the spatial distinctions are preserved, which facilitates matching PADRINO data with, for example, gridded environmental data (_e.g._ Compagnoni et al. 2021b, Case Study 2).

Finally, there are two important details potential users should be aware of. The first detail is that PADRINO provides IPMs _as they are published following peer review_. I do not alter these IPMs when digitizing them, except to correct typographical errors that may have found their way into the peer-reviewed publication. The second detail is that PADRINO does not store any raw data used to create the IPMs. Users should be aware of these, and I encourage all users to consult and cite the original publications of each IPM before including it in an analysis. 

## The Digitization Process

The IPM digitization process begins when a peer-reviewed paper containing an IPM is published. I have set alerts for the following keyword searches: "Integral Projection Model OR IPM OR sensitivit* OR elasticit* OR Vital rate OR LTRE". This automatic weekly search is run on Google Scholar and Scopus, and resulting hits are examined manually to find publications that contain an IPM. Once a paper containing an IPM is identified,I extract five types of metadata: taxonomic information (_e.g._ species names, functional groups), publication information (_e.g._ authors, complete citation, year of publication), temporal metadata (_e.g._ study duration, data collection beginning and ending months and years), spatial metadata (_e.g._ latitude/longitude, ecoregion), and model specific metadata (_e.g._ experimental treatments applied, density-(in)dependent). Table 3 contains a complete description of the metadata table in PADRINO. 

Following the metadata digitization, I extract functional forms of each sub-kernel, vital rate function, and how the environment varies (if applicable). The functional forms of each component of the model are expressed in the syntax introduced above. Finally, I extract all of the parameter values, as well as information on the range of values each trait can take on and how they are numerically approximated (_i.e._ integration rules). The parameter values and integration information are then substituted for symbol names when the user requests a built model. For example, in _Rpadrino_, the `Norm(mu_g, sd_g)` from above would be translated to `dnorm(z_2, mu_g, sd_g)` (see _Rpadrino_ below for more details). 

Often times, not all of the required information is present in the publication or its supplementary materials. Therefore, I often contact authors to request the required information and/or ask for clarification. I also extract a target value for the data validation step (see next section), so that I can ensure that released data really does replicate the published IPM. A complete guide to our digitization process and documentation of the database syntax is publicly available on PADRINO's webpage (https://padrinoDB.github.io/Padrino/).


## Data Validation and Reproducibility

The PADRINO IPM Database has automated testing built into the data release process. All IPMs are checked to ensure they recover the behavior of the published version prior to release. In most cases, validation consists of reproducing the kernel-specific asymptotic population growth rate ($\lambda$) to within $\pm$ 0.03 of the published $\lambda$ value in the source publication. It is worth noting that this margin of error is considerably lower than the uncertainty that arises from fitting statistical models to the raw data used in the IPM (_e.g._ Clark 2003), and so it should be acceptable for almost any application. For stochastic models with continuously varying environments, it is often not computationally feasible to re-run the IPM for 10-50,000 iterations since they are time consuming to run and there are many in PADRINO. Thus, I manually check for shorter term behavior that is similar to published dynamics (_e.g._ stochastic population growth rate ($\lambda_s$) after 1000 iterations). For publications where population growth rates are not available, I manually examine the publication and check the model digitized in PADRINO against some reported behavior (_e.g._ generation time). A given IPM can only enter a scheduled database release if it is explicitly flagged by a digitizer as validated, or if it passes its automated test. The manual testing functionality is contained in the open source _R_ package _pdbDigitUtils_ (available on GitHub (https://github.com/padrinoDB/pdbDigitUtils)), and PADRINO's build scripts are in the project's GitHub repository (https://github.com/padrinoDB/Padrino/tree/main/R). 

## Rpadrino

_Rpadrino_ is an _R_ package that contains functions for downloading the PADRINO database, data querying and management, and modifying existing functional forms and parameter values. Additionally, _Rpadrino_ provides wrappers around functions from _ipmr_ (Levin et al. 2021), which is a general engine for creating IPMs from functional forms and parameter estimates in _R_. These wrappers translate PADRINO's syntax into _ipmr_'s syntax, enabling users to select appropriate models based on the provided metadata, and then reconstruct the IPMs with only a few function calls. _Rpadrino_ uses _ipmr_'s `proto_ipm` data structure as an intermediate step between a set of functional forms and parameters, and an implemented IPM in both _ipmr_ and _Rpadrino_. The intermediate step enables users to combine their own IPMs with ones from PADRINO. Finally, _Rpadrino_ provides methods for PADRINO objects for the generic analysis functions in _ipmr_. Figure 2.2 provides an overview of the relationships between each of these packages.

\newpage
```{r echo = FALSE, dpi = 450, fig.height = 16, fig.width = 36, fig.cap = "**Figure 2.2**: An overview of the relationships between the *PADRINO* IPM Database, and the *Rpadrino*, and *ipmr* R packages. *PADRINO* stores a general syntax for representing IPMs, which *Rpadrino* translates into *R* code that makes use of *ipmr*. The *pdbDigitUtils* package provides utilities to the digitizing team to ensure that models are entered correctly. Arrows show the flow of information through the process of digitizing, downloading, and analyzing data. Black boxes denote user-facing steps. Briefly, a model is digitized and then checked following publication (1). *Rpadrino* downloads the *PADRINO* IPM database, and translates *PADRINO* IPMs into usable *R* code (2). The *ipmr* R package is then used to generate actual IPM objects. Users do not necessarily need to know how to use *ipmr* to use *PADRINO* because *Rpadrino* provides wrapper functions around most of *ipmr*'s functionality (3). Once an IPM or set of IPM objects are created, users can call functionality from Rpadrino, ipmr, or other packages to address their broader research  questions (4)."}

fig <- readPNG("Figures/pdb_depends_workflow_diagram.png")

fig_grob <- rasterGrob(fig, interpolate = TRUE)

plt <- qplot(1:14, 1:14, geom = "blank") +
  annotation_custom(fig_grob,
                    xmin = -Inf,
                    xmax = Inf,
                    ymin = -Inf,
                    ymax = Inf) +
  theme_void()

print(plt)

```

The flexibility of IPMs and their broad application across ecology, evolution, and conservation biology mean that there is no fixed set of steps in a workflow using _Rpadrino_. However, there are generally four steps that a researcher must take when using these tools. The first step is to identify studies of interest, and, optionally, augment PADRINO's metadata with additional information from other sources (_e.g._ environmental data, GBIF). _Rpadrino_'s representation of PADRINO objects is designed to accommodate the range of further analyses that researchers may be interested in. Users may augment any table with additional information corresponding to, for example, spatial or temporal covariates from other open access databases. 

The second step in an _Rpadrino_ workflow is to construct a list of `proto_ipm` objects using `pdb_make_proto_ipm()` (Figure 2.2). This function translates PADRINO's syntax into _ipmr_ code, and then builds a `proto_ipm` object for each unique `ipm_id`. For some models, users may choose to create deterministic or stochastic IPMs at this step. _Rpadrino_'s default behavior is to generate deterministic models whenever possible. This behavior encompasses instances where authors generated models with no time or space varying parameters, and where authors included discretely varying environments. The latter can be implemented as deterministic models because all parameter values are known before the model is built. Models with continuous environmental variation require sampling the environment at each model iteration, usually by sampling from distributions randomly. These are always considered stochastic models.

The third step in an _Rpadrino_ workflow is creating IPM objects with `pdb_make_ipm()` (Figure 2.2). `pdb_make_ipm()` uses _ipmr_'s `make_ipm()` function to build IPM objects. Users may specify additional options to pass to to `make_ipm()` (_e.g._ normalize the population size to always equal 1, return the vital rate function values as well as the sub-kernels and population state). The various arguments users can modify are described in the _ipmr_ documentation for `make_ipm()`.

The fourth and final step in an _Rpadrino_ workflow is to conduct the analyses of interest. _Rpadrino_ provides wrappers around _ipmr_ functions to extract per-capita growth rates, eigenvectors (Caswell 2001, Ellner, Childs & Rees 2016 Ch. 2), assess convergence to asymptotic dynamics (Caswell 2001), compute mean kernels for stochastic IPMs (Ellner, Childs & Rees Ch 7), and modify existing IPMs with new parameter values and functional forms. Additionally, the documentation on the [Rpadrino website](https://padrinODB.github.io/Rpadrino/index.html) and the Supplementary Materials for this paper contain details on how to conduct more complicated analyses with IPM objects (_e.g._ perturbation analyse (Ellner, Childs & Rees 2016 Ch 4), size at death calculations (Metcalf et al. 2009)). The package documentation and the recent publication describing _ipmr_ also contain code demonstrating analyses on single IPM objects (Levin et al. 2021). These can be extended via the `apply` family of functions.  

## Challenges

Digitizing IPMs into the PADRINO IPM Database is not without issues. First, it is often the case that the complete form of the IPM is not reported: approximately 80% of papers I have examined thus far fall into this category. Many studies may report the general form of the model (_e.g._ $n(z',t+1) = \int_L^U K(z',z)n(z,t)dz$), but do not then report the functional forms of the sub-kernels or vital rates. Without the functional form of all vital rates and sub-kernels, it is impossible to reproduce the IPM. Second, some parameter values may be missing from the main text or supplementary materials - common culprits are terms for the variation of the growth/fecundity kernels, number of meshpoints, and integration bounds (i.e. $L,U$ in Eq 1). The authors of this paper have been guilty of this, as well as other sins of omission, in their own IPM publications. The intent here is not to alienate other authors, but offer a gentle reminder that reporting all parameter values and functional forms can go a long way towards making their science reusable and extensible. Reproducible science can often bring great benefit to the original authors as well as the broader community (Kousta et al. 2019).

In addition to the challenges on the data digitization side, important challenges remain in the reconstruction of IPMs. Semi- or non-parametric models may be used to generate IPMs, and I have not yet defined a syntax in PADRINO for representing these vital rate models, though work is ongoing. Additionally, _ipmr_ is not yet able to handle two-sex models (_e.g._ Stubberud et al. 2019), time-lagged models (_e.g._ Rose et al. 2005), or periodic models (_e.g._ Letcher et al. 2014). These types of IPMs do not yet represent a substantial portion of the literature. Nonetheless, it is our intention to continue developing functionality to accommodate them in future releases of PADRINO, _ipmr_, and _Rpadrino_. 

## Opportunities and Future Directions

PADRINO is designed to be compatible with other databases. Its metadata table closely resembles that of COMPADRE and COMADRE (Salguero-Gómez et al. 2015). This means that users who are familiar with these matrix population model databases should find a smooth transition to working with PADRINO. Furthermore, I provide a comprehensive set of metadata that allows users to match information in PADRINO with other databases  (_e.g._ gridded climate data, functional trait information, phylogenetic information). These features will enable researchers to carry out more detailed and comprehensive analyses at various spatial, temporal, and phylogenetic scales.

PADRINO presents unique opportunities for synthesis in both theoretical and applied contexts. The expanded range of phylogenetic and geographical coverage can be used in conjunction with other demographic databases (_e.g._ COM(P)ADRE (Salguero-Gómez et al. 2015, Salguero-Gómez et al. 2016), popler (Compagnoni et al. 2019), DatLife (DatLife 2021)) to power larger scale syntheses than were possible before (_e.g._ Compagnoni et al. 2021b). For example, one could use IPMs from PADRINO and matrix population models from COMPADRE and COMADRE to create life tables (Jones et al. 2021), which could then be combined with life tables from DATLife for further analysis (_e.g._ Jones et al. 2014). The intermediate life table conversion steps may not be necessary, as many of the same life history traits and population level parameters may be calculated from all of these models (Caswell 2001, Ellner, Childs & Rees 2016). Furthermore, recent publications combine biotic and abiotic interactions into demographic models providing a robust theoretical toolbox for exploring species responses to environmental drivers such as climate change (_e.g._ Simmonds et al. 2020, Abrego et al. 2021). _Rpadrino_ also provides functionality to modify parameter values and functional forms of the IPMs it stores, giving theoreticians a wide array of realistic life histories to experiment with. These examples are far from an exhaustive list, but hopefully demonstrates the potential for this new tool in demography, ecology, and evolutionary biology. 

\newpage

```{r echo = FALSE}

cap <- "**Table 2.1**: Summaries of the information contained in each table of the PADRINO database. A complete guide to each column in each table is available on the project's webpage in the form of the guide provided to digitizers (there are too many columns to provide the information here)."

md_desc <- "This table contains metadata for each IPM. This is organized into taxonomic information (full taxonomy plus functional group information), publication information (citation, authorship, source), data collection information (study period/duration, GPS coordinates, ecoregion), and model specific information (studied sexes, eviction corrections, treatments applied, and model implementation details). See Table 3 for more information on these columns."

sv_desc <- "This table contains the names of the state variables used in the model and whether or not they are discrete or continuously distributed."

cd_desc <- "This table contains names and ranges for each continuously distributed state variable in the model, as well as which kernels they apply to (kernels are the P(z',z), F(z',z), and C(z',z) in Eq 1)."

ir_desc <- "This table contains information on how each continuous state variable is numerically approximated in the model (i.e. number of meshpoints, which integration rule was used)."

ps_desc <- "This table contains the names of the population trait distributions used in the model (n(z,t) and n(z',t+1) in Eq. 1)."

ik_desc <- "This table contains the functional forms of each sub-kernel in the IPM (e.g. P(z',z) in Eq 1 becomes 'P = s * G'), and information on which traits it acts on and creates. This table makes use of [parameter set index notation](https://levisc8.github.io/ipmr/articles/index-notation.html) from 'ipmr' to concisely represent models which may produce many kernels."

vr_desc <- "This table contains the functional forms of each vital rate in the IPM (e.g. 'mu_g = int_g + slope_g * z_1'). This table makes use of [parameter set index notation](https://levisc8.github.io/ipmr/articles/index-notation.html) from 'ipmr' to concisely represent models which may produce many kernels."

pv_desc <- "This table contains the names and values of each parameter in the model, with the exception of parameters that are associated with continuous environmental variation."

ev_desc <- "This table contains parameter values and functional forms of any continuously varying environmental conditions (e.g. yearly variation in precipitation and/or temperature). Any model that contains information in this table is considered stochastic by default, as these variables must be sampled at least once to construct a model with 'Rpadrino'."

pi_desc <- "This table contains the parameter set indices. These are substituted into the IPM kernels and vital rate expressions when a model is built, so that a single symbolic expression can represent an arbitrary number of realized expression. For example, the vital rate expression 'mu_g_yr = g_int_yr + g_slope * z_1' can be used to represent a range of years for a model with year-specific intercepts. This table contains values substituted in for '_yr' across the model. See the [ipmr vignette on Index Notation](https://levisc8.github.io/ipmr/articles/index-notation.html) for more details."

col_df <- data.frame(
  tab_nm = c("Metadata", 
             "State Variables",
             "Continuous States",
             "Integration Rules",
             "Population Trait Distributions",
             "IPM Sub-kernels",
             "Vital Rate Functions",
             "Parameter Values",
             "Continuous Environmental Variation",
             "Parameter Set Indices"),
  description = c(md_desc,
                  sv_desc,
                  cd_desc,
                  ir_desc,
                  ps_desc,
                  ik_desc,
                  vr_desc,
                  pv_desc,
                  ev_desc,
                  pi_desc) 
)

kable(col_df,
      format = "latex",
      col.names = c("Table", "Description"),
      caption = cap) %>%
  column_spec(2, width = "4.5in", border_right = TRUE) %>%
  column_spec(1, border_left = TRUE)
```


\newpage

```{r echo = FALSE}

cap <- "**Table 2.2**: Taxonomic representation of IPMs in PADRINO. These numbers represent the number of models that are error checked and accurately reproduce the published IPM (see 'Data Validation' for more details). Models that are partially entered or still contain errors are not considered here. I are in the process of correcting them and/or retrieving additional information from the authors."
  
kable(tot,
      format = "latex",
      col.names = c("Kingdom", 
                    "# of Unique ipm_id's", 
                    "# of Unique Species",
                    "# of Publications"),
      caption = cap) %>%
  column_spec(1, border_left = TRUE) %>%
  column_spec(4, border_right = TRUE)

```


\newpage

```{r echo = FALSE, message = FALSE, warning = FALSE}

cap <- "**Table 2.3**: All columns contained in the Metadata table. "

met_tab <- data.frame(
  concept = c(
    NA_character_,
    "Taxonomy",
    rep(NA_character_, 10),
    "Source",
    rep(NA_character_, 8),
    "Temporal Metadata",
    rep(NA_character_, 5),
    "Spatial Metadata",
    rep(NA_character_, 7),
    "Model-specific metadata",
    rep(NA_character_, 7)
  ),
  var_nm = c(
    "ipm_id",
    "species_author",
    "species_accepted", 
    "tax_genus", 
    "tax_family", 
    "tax_order", 
    "tax_class",
    "tax_phylum",
    "kingdom", 
    "organism_type", 
    "dicot_monocot", 
    "angio_gymno", 
    "authors",
    "journal", 
    "pub_year", 
    "doi", 
    "corresponding_author", 
    "email_year",
    "remark", 
    "apa_citation",
    "demog_appendix_link", 
    "duration",
    "start_year", 
    "start_month", 
    "end_year",
    "end_month", 
    "periodicity", 
    "population_name", 
    "number_populations", 
    "lat", 
    "lon",
    "altitude", 
    "country", 
    "continent", 
    "ecoregion", 
    "studied_sex", 
    "eviction_used", 
    "evict_type",
    "treatment", 
    "has_time_lag", 
    "has_age",
    "has_dd",
    "is_periodic"
  ),
  Description = c(
    "Unique ID for each model.",
    "The Latin species name used by the authors of the paper.",
    "The Latin species name accepted by Catalogue of Life.",
    "The genus name accepted by Catalogue of Life.",
    "The family name accepted by Catalogue of Life.",
    "The order name accepted by Catalogue of Life.",
    "The class name accepted by Catalogue of Life.",
    "The phylum name accepted by Catalogue of Life.",
    "The kingdom name accepted by Catalogue of Life.",
    "General functional type of the species (_e.g._ annual, fern, mammal, reptile).",
    "If a plant species, whether the species is a dicot or a monocot.",
    "If a plant species, whether the species is an angiosperm, gymnosperm, or neither.",
    "All of a study authors' last names, separated by ';'.",
    "Abbreviated journal name (www.abbreviations.com/jas.php), or 'PhD', 'MSc' if a thesis.",
    "The year of publication.",
    "Digital object identifier and/or ISBN (if available).",
    "The name of the corresponding author on the paper.",
    "The email address of the corresponding author and the year it was extracted (some email addresses may be defunct now).",
    "Additional remarks from the digitizer regarding the publication, if any.",
    "The full APA citation for the source.",
    "The URL for the Supplementary information containing additional model details, if available.",
    "The duration of the study, defined 'study_end - study_start + 1'. Does not consider skipped years.",
    "The year demographic data collection began.",
    "The month demographic data collection began.",
    "The year demographic data collection ended.",
    "The month demographic data collection ended.",
    "Frequency of the model (1: annual transition, 2: semi-annual transition, 0.2: 5 year transition).",
    "The name of the population given in the data source.",
    "The number of populations that a given model describes.",
    "The decimal latitude of the population.",
    "The decimal longitude of the population.",
    "The altitude of the population above sea level, obtained either from the publication or Google Earth.",
    "The ISO3 code for the country or countries in which the data were collected.",
    "The continent or continents on which the data were collected.",
    "The terrestrial or aquatic ecoregion corresponding to the [World Wildlife Fund](https://www.worldwildlife.org/biomes) classification. If data are from a controlled setting (greenhouse, lab), denoted with 'LAB'.",
    "Sexes used to construct the model.",
    "Whether or not the authors explicitly state that they corrected for eviction (see Williams et al. 2012).",
    "If the authors did correct for eviction, then the type of correction that was applied. Current options are 'stretched_domain', 'truncated_distributions', and 'disctrete_extrema'.",
    "A description of any experimental treatment applied to the population.",
    "Whether or not the model contains a time lagged vital rate/kernel.",
    "Whether or not the model has age structure in addition to other continuous state variables.",
    "Whether or not the model is density dependent.",
    "Whether or not the model is periodic."
  )
  
)

met_tab$concept[is.na(met_tab$concept)] <- ""


kable(met_tab,
      format = "latex",
      col.names = c("Concept", "Column Name", "Description"),
      caption = cap) %>%
  column_spec(1, border_left = TRUE) %>%
  column_spec(3, border_right = TRUE, width = "3in")

```
 
\newpage   

### Citations

1. Easterling, M.R., Ellner, S.P., & Dixon, P.M. (2000). Size specific sensitivity: applying a new structured population model. Ecology 81(3): 694-708.

2. Ellner, S.P. & Rees, M. (2006). Integral Projection Models for species with complex demography. The American Naturalist 167(3): 410-428.

3. Hartemink, N., & Caswell, H. (2018). Variance in animal longevity: contributions of heterogeneity and stochasticity. Population Ecology 60: 89-99. https://doi.org/10.1007/s10144-018-0616-7

4. DATLife – The Demography Across the Tree of Life – database. Max-Planck Institute for Demographic Research (Germany). Available at www.datlife.org. (2021)

5. Salguero‐Gómez, R., Jones, O.R., Archer, C.R., Bein, C., de Buhr, H., Farack, C., Gottschalk, F., Hartmann, A., Henning, A., Hoppe, G., Roemer, G., Ruoff, T., Sommer, V., Wille, J. Voigt, J., Zeh, S., Vieregg, D., Buckley, Y.M., Che-Castaldo, J., Hodgson, D., et al. (2016) COMADRE: a global database of animal demography. Journal of Animal Ecology 85: 371-384. https://doi.org/10.1111/1365-2656.12482

6. Salguero-Gómez, R, Jones, O.R., Archer, C.A., Buckley, Y.M., Che-Castaldo, J., Caswell, C., Hodgson, D., Scheuerlein, A., Conde, D.A., Brinks, E., de Buhr, H., Farack, C., Gottschalk, F., Hartmann, A., Henning, A., Hoppe, G., Roemer, G., Runge, J., Ruoff, T., et al. (2014) The COMPADRE Plant Matrix Database: an online repository for plant population dynamics. Journal of Ecology 103: 202-218. https://doi.org/10.1111/1365-2745.12334

7. Compagnoni, A., Pardini, E., & Knight, T.M. (2021a). Increasing temperature threatens an already endangered coastal plant species. Ecosphere 12(3): e03454. https://doi.org/10.1002/ecs2.3454

8. Compagnoni, A., Levin, S.C., Childs, D.Z., Harpole, S., Paniw, M., Roemer, G., Burns, J.H., Che-Castaldo, J., Rueger, N., Kunstler, G., Bennett, J.M., Archer, C.R., Jones, O.R., Salguero-Gómez, R., & Knight, T.M. (2021b). Herbaceous perennial plants with short generation time have stronger responses to climate anomalies than those with longer generation time. Nature Communications 12: 1824. https://doi.org/10.1038/s41467-021-21977-9

9. Levin, S.C., Childs, D.Z., Compagnoni, A., Evers, S., Knight, T.M., & Salguero-Gómez, R. (2021) ipmr: Flexible implementation of Integral Projections Models in R. Methods in Ecology and Evolution. https://doi.org/10.1111/2041-210X.13683

10. Jongejans, E., Shea, K., Skarpaas, O., Kelly, D., & Ellner, S.P. (2011). Importance of individual and environmental variation for invasive species spread: a spatial integral projection model. Ecology 92(1): 86-97. https://doi.org/10.1890/09-2226.1

11. Jelbert, K., Buss, D., McDonald, J., Townley, S., Franco, M., Stott, I., Jones, O., Salguero-Gómez, R., Buckley, Y., Knight, T.M., Silk, M., Sargent, F., Rolph, S., Wilson, P., & Hodgson, D. (2019). Demographic amplification is a predictor of invasiveness among plants. Nature Communications 10: 5602. https://doi.org/10.1038/s41467-019-13556-w 

12. Erickson, R.A., Eager, E.A., Brey, M.B., Hansen, M.J., & Kocovsky, P.M. (2017). An integral projection model with YY-males and application to evaluating grass carp control. Ecological Modelling 361: 14-25. https://doi.org/10.1016/j.ecolmodel.2017.07.030

13. Childs, D.Z., Rees, M., Rose, K.E., Grubb, P.J., & Ellner, S.P. (2004). Evolution of size-dependent flowering in a variable environment: construction and analysis of a stochastic integral projection model. Proceedings of the Royal Society B 271(1547): 425-434. https://doi.org/10.1098/rpsb.2003.2597

14. Ellner, S.P., Childs, D.Z., Rees, M. (2016) Data-driven modelling of structured populations: a practical guide to the integral projection model. Basel, Switzerland: Springer International Publishing AG

15. Leslie, P.H. (1945). The use of matrices in certain population mathematics. Biometrika 33(3): 183-212.

16. Caswell, H. (2001) Matrix population models: construction, analysis, and interpretation, 2nd edn. Sunderland, MA: Sinauer Associates Inc

17. Adler, P.B., Ellner, S.P. & Levine, J.M. (2010). Coexistance of perennial plants: an embarassment of niches. Ecology Letters 13: 1019-1029. https://doi.org/10.1111/j.1461-0248.2010.01496.x

18. Abrego, N., Roslin, T., Huotari, T., Ji, Y., Schmidt, N.M., Wang, J., Yu, D.W., & Ovaskainen, O. (2021) Accounting for species interactions is necessary for predicting how arctic arthropod communities respond to climate change. Ecography. https://doi.org/10.1111/ecog.05547 

19. Henry, L., & Wickham, H. (2021). rlang: Functions for Base Types and Core R and 'Tidyverse' Features. R package version 0.4.11. https://CRAN.R-project.org/package=rlang

20. Crone, E.E., Menges, E.S., Ellis, M.M., Bell, T., Bierzychudek, P, Ehrlen, J. et al. (2011) How do ecologists use matrix population models? Ecology Letters 14(1): 1-8. DOI: https://doi.org/10.1111/j.1461-0248.2010.01540.x

21. Doak, D. & Morris W.F. (2002). Quantitative Conservation Biology: Theory and Practice of Population Viability Analysis. Oxford, UK: Oxford University Press

22. RSG + Gamelon M. (2021). Demographic Methods Across the Tree of Life. Oxford, UK: Oxford University Press

23. Coulson, T., MacNulty, D.R., Stahler, D.R., von Holdt, B., Wayne, R.K., & Smith, D.W. (2011). Modeling effects of environmental change on wolf population dynamics, trait evolution, and life history. Science 334(6060): 1275-1278. https://doi.org/10.1126/science.1209441

24. Stott, I., et al. (2011). A framework for studying transient dynamics of population projection matrix models. Ecology Letters 14: 959-970. DOI: https://doi.org/10.1111/j.1461-0248.2011.01659.x

25. Clark, J.S. (2003) Uncertainty and variability in demography and population growth: A hierarchical approach. Ecology 84(6): 1370-1381. 

26. Letcher, B.H., Schueller, P., Bassar, R.D., Nislow, K.H., Coombs, J.A.,Sakrejda, K. _et al._ (2014). Robust estimates of environmental effects on population vital rates: an integrated capture-recapture model of seasonal brook trout growth, survival and movement in a stream network. Journal of Animal Ecology 84(2): 337-352. https://doi.org/10.1111/1365-2656.12308

27. Stubbered, M.W., Vindenes, Y., Vollestad, L.A, Winfield, I.J., Stenseth, N.C., & Langangen, O. (2019). Effects of size- and sex-selective harvesting: an integral projection model approach. Ecology and Evolution 9: 12556-12570. https://doi.org/10.1002/ece3.5719

28.  Maitner, B., Boyle B., Casler N., Condit R., Donoghue J., Duran S.M.,  _et al._ (2017) The bien r package: A tool to access the Botanical Information and Ecology Network (BIEN) database.  Methods in Ecology and Evolution 9(2): 373-379. https://doi.org/10.1111/2041-210X.12861

29. Simmonds E.G., Cole, E.F., Sheldon, B.C., & Coulson, T. (2020). Phenological asynchrony: a ticking time-bomb for seemingly stable populations? Ecology Letters 23(12): 1766-1775. https://doi.org/10.1111/ele.13603

30. Kousta, S., Pastrana, E., & Swaminathan, S. (2019). Three approaches to support reproducible research. Science Editor 42(3): 77-82.

31. Jones, O.R., Scheuerlein, A., Salguero-Gómez, R., Camarda, C.G., Schaible, R., Casper, B.B., _et al._ (2014). The diversity of ageing across the tree of life. Nature 505: 169-173. https://doi.org/10.1038/nature12789

32. Jones, O.R., Barks, P., Stott, I., James, T.D., Levin, S.C., Petry, W.K. _et al._ (2021). Rcompadre and Rage - two R packages to facilitate the use of the COMPADRE and COMADRE databases and calculation of life history traits from matrix population models. bioRxiv. https://doi.org/10.1101/2021.04.26.441330

